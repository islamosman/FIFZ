{"version":3,"sources":["../../src/pages/subscription/subscription.module.ts","../../src/models/usermodel.ts","../../src/pages/subscription/subscription.ts"],"names":[],"mappings":"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","file":"6.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { SubscriptionPage } from './subscription';\n\n@NgModule({\n  declarations: [\n    SubscriptionPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(SubscriptionPage),\n  ],\n})\nexport class SubscriptionPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/subscription/subscription.module.ts","// import { reservationEnum } from \"../providers/Enums/reservationEnum\";\r\n\r\nexport class UserModel {\r\n  userId: number;\r\n  username: string;\r\n  password?: string;\r\n  name?: string;\r\n  userCode?: string;\r\n  tocken?: any;\r\n  UserIdToB?: string;\r\n  TockenToB?: string;\r\n}\r\n\r\nexport class RegisterModel {\r\n  device_unique_id: string;\r\n  phone_number: number;\r\n  email: string;\r\n  password: string;\r\n  first_name: string;\r\n  last_name?: string;\r\n  gender?: boolean;\r\n  date_of_birth?: Date;\r\n}\r\nexport class VerifyModel {\r\n  mobileNumber: Number;\r\n  messageStr: string;\r\n  passCode: string;\r\n  email: string;\r\n}\r\nexport class LoginModel {\r\n  urlStr: string = \"http://localhost:30823/\";\r\n  username: string;\r\n  password: string;\r\n}\r\n\r\nexport class UserStateModel {\r\n  IdStatus: boolean;\r\n  VisaStatus: boolean;\r\n  RefundOrderId: string;\r\n  Tocken: string;\r\n  UserId: string;\r\n  IsRefunded:boolean;\r\n}\r\n\r\n\r\nexport class SubscriptionModel {\r\n  PhoneNumber: number;\r\n  Location: string;\r\n  Lng: number;\r\n  Lat: number;\r\n  DaysCount: number;\r\n  DateTimeStr: string;\r\n  DateStr: Date;\r\n  TimeStr: string;\r\n  PromoCodeName?: string;\r\n  tocken: string;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/models/usermodel.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Events, DateTime } from 'ionic-angular';\nimport { SubscriptionModel, UserStateModel } from '../../models/usermodel';\nimport { ErrorModel } from '../../models/errorModel';\nimport { AlertsProvider } from '../../providers/generic/AlertsProvider';\nimport { AuthProvider } from '../../providers/auth/auth';\nimport { ResponseModel } from '../../models/ResponseModel';\nimport { VehiclsProvider } from '../../providers/Map/vechilsApi';\nimport { LocationsProvider } from '../../providers/Map/locations';\nimport { Storage } from '@ionic/storage';\n\n/**\n * Generated class for the SubscriptionPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-subscription',\n  templateUrl: 'subscription.html',\n})\nexport class SubscriptionPage {\n\n  subscriptionModel: SubscriptionModel;\n  errorModel: ErrorModel;\n  dateNow: string = \"\";\n  constructor(public navCtrl: NavController, public navParams: NavParams, private _location: LocationsProvider,\n    public _VehiclsProvider: VehiclsProvider, public _alerts: AlertsProvider, public _authProvider: AuthProvider\n    , private storage: Storage, public events: Events) {\n    this.subscriptionModel = new SubscriptionModel();\n    this.dateNow = new Date().getFullYear() + \"-\" + (new Date().getMonth() + 1) + \"-\" + new Date().getDate();\n  }\n\n  ionViewDidLoad() {\n    // this.storage.get('UserState').then(user => {\n\n    //   if (user != undefined && user != \"\") {\n    //     this.events.publish('user:created', user);\n    //   } else {\n    //     this.events.publish(\"unauthorized:requestError\");\n    //   }\n    // });\n  }\n\n\n  subscription() {\n\n    this._alerts.showLoader();\n    \n    if (this.subscriptionModel.PromoCodeName != \"\") {\n      this.checkPromoCode();\n    } else {\n      this._location.GetCurrent().then(((resp) => {\n        this.subscriptionModel.Lat = resp.coords.latitude;\n        this.subscriptionModel.Lng = resp.coords.longitude;\n\n        this.payFirst();\n      })).catch(err => {\n        this.payFirst();\n      });\n    }\n\n    // this.storage.get('UserState').then(user => {\n    //   console.clear();\n    //   console.table(user);\n    //   //if (user != undefined && user != \"\") {\n    //   this.events.publish('user:created', user);\n    //   //}\n\n    //   this.subscriptionModel.tocken = user.tocken;\n\n    //   this._location.GetCurrent().then(((resp) => {\n    //     this.subscriptionModel.Lat = resp.coords.latitude;\n    //     this.subscriptionModel.Lng = resp.coords.longitude;\n\n    //     this.payFirst();\n    //   })).catch(err => {\n\n    //     this.payFirst();\n    //   });\n\n    // });\n  }\n\n  discountPer: number = 0;\n\n  checkPromoCode() {\n    this._VehiclsProvider.checkPromo(this.subscriptionModel.PromoCodeName).subscribe(returnData => {\n      if (returnData.IsDone) {\n        this.discountPer = returnData.ReturnedObject;\n      }\n      this.payFirst();\n    });\n  }\n\n  payFirst() {\n    let amountTpPay = 5;\n    if (this.subscriptionModel.DaysCount == 1) {\n      amountTpPay = 80;\n    } else if (this.subscriptionModel.DaysCount == 3) {\n      amountTpPay = 220;\n    } else if (this.subscriptionModel.DaysCount == 7) {\n      amountTpPay = 470;\n    } else if (this.subscriptionModel.DaysCount == 30) {\n      amountTpPay = 1350;\n    }\n\n    if (this.subscriptionModel.DaysCount != 30) {\n      if (this.discountPer != 0) {\n        amountTpPay = (amountTpPay * this.discountPer) / 100;\n      }\n    }\n\n    this.storage.get('UserIDVisaState').then(user => {\n      let result = <UserStateModel>user;\n      console.clear();\n      console.table(result)\n      if (result != null) {\n\n        this._VehiclsProvider.payment1().subscribe(returnData1 => {\n          if (returnData1) {\n            this._VehiclsProvider.payment2(returnData1.token, amountTpPay, \"S\" + this.subscriptionModel.DaysCount.toString() + new Date().getMinutes().toString() + result.UserId).subscribe(returnData2 => {\n              this._VehiclsProvider.payment3(returnData1.token, amountTpPay, returnData2.id,5046).subscribe(returnData3 => {\n                console.log(returnData1.token)\n                this._VehiclsProvider.paymentBackToBack(returnData3.token, result.Tocken).subscribe(returnData3 => {\n\n                  this.saveData();\n\n                });\n\n              });\n            });\n          }\n        });\n      } else {\n        this.getUserStatus();\n        // this._alerts.hideLoader();\n      }\n    });\n  }\n\n  getUserStatus() {\n    this._authProvider.userStates().subscribe(result => {\n      this.storage.set('UserIDVisaState', result.ReturnedObject);\n      this.payFirst();\n    });\n  }\n\n  saveData() {\n    this.subscriptionModel.DateTimeStr= this.subscriptionModel.DateStr + \" \"  + this.subscriptionModel.TimeStr;\n    this._VehiclsProvider.subscription(this.subscriptionModel).subscribe(data => {\n      this._alerts.hideLoader();\n      let registerResult = <ResponseModel>data;\n      if (registerResult.IsDone) {\n        this._alerts.showWarningToaster(registerResult.MessegesStr);\n      } else {\n        this._alerts.showWarningToaster(registerResult.ErrorMessegesStr);\n      }\n    },\n      err => {\n        this._alerts.hideLoader();\n        this.errorModel = <ErrorModel>err;\n        if (this.errorModel.status == 0) {\n          this._alerts.showServiceError();\n        } else {\n          this._alerts.showErrorToaster(this.errorModel.message);\n        }\n      }\n    );\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/subscription/subscription.ts"],"sourceRoot":""}